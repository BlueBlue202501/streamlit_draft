<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—å…ƒé¡åº¦ç­–ç•¥æ¶æ§‹è¨ˆç®—å™¨</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1565C0, #1976D2);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .main-content {
            display: flex;
            min-height: 800px;
        }
        
        .form-panel {
            width: 300px;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
            max-height: 800px;
        }
        
        .svg-panel {
            flex: 1;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }
        
        .svg-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
            align-items: center;
            max-width: 280px;
        }
        
        .zoom-btn {
            padding: 8px 12px;
            background: #1976D2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.2s;
        }
        
        .zoom-btn:hover {
            background: #1565C0;
        }
        
        .export-btn {
            background: #4CAF50 !important;
        }
        
        .export-btn:hover {
            background: #45a049 !important;
        }
        
        .export-btn:disabled {
            background: #cccccc !important;
            cursor: not-allowed;
        }
        
        .export-select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            background: white;
            color: #333;
            min-width: 140px;
        }
        
        .zoom-info {
            padding: 8px 12px;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 12px;
            color: #666;
            display: flex;
            align-items: center;
        }
        
        .svg-container-wrapper {
            width: 100%;
            height: 100%;
            overflow: auto;
            cursor: grab;
        }
        
        .svg-container-wrapper:active {
            cursor: grabbing;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .section-title {
            background: #e3f2fd;
            padding: 10px;
            margin: 15px -20px;
            font-weight: bold;
            color: #1565C0;
            border-left: 4px solid #1565C0;
        }
        
        .calculated-value {
            background: #fff3e0;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #f57c00;
            margin-top: 5px;
        }
        
        .svg-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            transition: transform 0.2s ease;
            transform-origin: 0 0;
        }
        
        /* SVG styles */
        .title-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #1565C0; }
        .section-title-svg { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #333; }
        .header-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #333; }
        .normal-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 14px; fill: #333; }
        .small-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 12px; fill: #333; }
        .white-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 14px; fill: white; font-weight: bold; }
        .highlight-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #D32F2F; }
        .percentage-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #1976D2; }
        
        .main-container { fill: #F8F9FA; stroke: #1976D2; stroke-width: 3; }
        .cost-section { fill: #FFF3E0; stroke: #FF9800; stroke-width: 2; }
        .basic-allocation { fill: #E8F5E8; stroke: #4CAF50; stroke-width: 2; }
        .reward-mechanism { fill: #F3E5F5; stroke: #9C27B0; stroke-width: 2; }
        .central-box { fill: #E3F2FD; stroke: #1976D2; stroke-width: 2; }
        .non-central-box { fill: #E8F5E8; stroke: #4CAF50; stroke-width: 2; }
        
        .tier1-box { fill: #4CAF50; stroke: #2E7D32; stroke-width: 1; }
        .tier2-box { fill: #FFC107; stroke: #F57C00; stroke-width: 1; }
        .tier3-box { fill: #FF9800; stroke: #E65100; stroke-width: 1; }
        .tier4-box { fill: #9E9E9E; stroke: #616161; stroke-width: 1; }
        .allocation-box { fill: #81C784; stroke: #388E3C; stroke-width: 2; }
        .no-allocation-box { fill: #FFCDD2; stroke: #D32F2F; stroke-width: 2; }
        
        .phase-indicator { fill: #FFE082; stroke: #F57C00; stroke-width: 2; }
        .connector { stroke: #666; stroke-width: 2; fill: none; }
        .phase-connector { stroke: #F57C00; stroke-width: 3; fill: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å­—å…ƒé¡åº¦ç­–ç•¥æ¶æ§‹è¨ˆç®—å™¨</h1>
            <p>è‡ªå‹•è¨ˆç®—ç™¾åˆ†æ¯”å’Œåˆ†é…é‡‘é¡</p>
        </div>
        
        <div class="main-content">
            <div class="form-panel">
                <div class="section-title">åŸºæœ¬è¨­å®š</div>
                
                <div class="form-group">
                    <label>ç¸½é ç®— (å„„å­—å…ƒ):</label>
                    <input type="number" id="totalBudget" value="8.4" step="0.1">
                    <div class="calculated-value">
                        ç¸½é ç®—: <span id="totalBudgetDisplay">8å„„4,000è¬å­—å…ƒ</span>
                    </div>
                </div>
                
                <div class="section-title">æˆæœ¬æ‰£é™¤é …ç›®</div>
                
                <div class="form-group">
                    <label>æ•™è‚²è¨“ç·´ (è¬å­—å…ƒ):</label>
                    <input type="number" id="training" value="7500" step="100">
                </div>
                
                <div class="form-group">
                    <label>æ¸¬è©¦ä½¿ç”¨ (è¬å­—å…ƒ):</label>
                    <input type="number" id="testing" value="12600" step="100">
                </div>
                
                <div class="form-group">
                    <label>æ–°å»ºä¸»æ©Ÿ (å„„å­—å…ƒ):</label>
                    <input type="number" id="newServer" value="2" step="0.1">
                </div>
                
                <div class="calculated-value">
                    ç¸½æˆæœ¬æ‰£é™¤: <span id="totalCost">4å„„100è¬å­—å…ƒ</span>
                </div>
                
                <div class="calculated-value">
                    å‰©é¤˜å¯åˆ†é…: <span id="remainingBudget">4å„„3,900è¬å­—å…ƒ</span>
                </div>
                
                <div class="section-title">åŸºæœ¬ç›¤é…ç½® (ç¬¬ä¸€éšæ®µ)</div>
                
                <div class="form-group">
                    <label>åŸºæœ¬ç›¤ç™¾åˆ†æ¯” (%):</label>
                    <input type="number" id="basicPercentage" value="20" step="1">
                </div>
                
                <div class="calculated-value">
                    åŸºæœ¬ç›¤ç¸½é¡: <span id="basicTotal">8,780è¬å­—å…ƒ</span>
                </div>
                
                <div class="form-group">
                    <label>ç¬¬ä¸€ç´šåˆ†é… (è¬å­—å…ƒ):</label>
                    <input type="number" id="tier1Amount" value="1000" step="50">
                </div>
                
                <div class="form-group">
                    <label>ç¬¬äºŒç´šåˆ†é… (è¬å­—å…ƒ):</label>
                    <input type="number" id="tier2Amount" value="300" step="50">
                </div>
                
                <div class="form-group">
                    <label>ç¬¬ä¸‰ç´šåˆ†é… (è¬å­—å…ƒ):</label>
                    <input type="number" id="tier3Amount" value="100" step="50">
                </div>
                
                <div class="form-group">
                    <label>ç¬¬å››ç´šåˆ†é… (è¬å­—å…ƒ):</label>
                    <input type="number" id="tier4Amount" value="50" step="25">
                </div>
                
                <div class="form-group">
                    <label>éä¸­å¤®æ©Ÿé—œçµ±ä¸€é…ç½® (è¬å­—å…ƒ):</label>
                    <input type="number" id="nonCentralAmount" value="2000" step="100">
                </div>
                
                <div class="section-title">çå‹µæ©Ÿåˆ¶ (ç¬¬äºŒéšæ®µ)</div>
                
                <div class="form-group">
                    <label>çå‹µæ©Ÿåˆ¶ç™¾åˆ†æ¯” (%):</label>
                    <input type="number" id="rewardPercentage" value="80" step="1">
                </div>
                
                <div class="calculated-value">
                    çå‹µæ©Ÿåˆ¶ç¸½é¡: <span id="rewardTotal">3å„„5,120è¬å­—å…ƒ</span>
                </div>
                
                <div class="form-group">
                    <label>åŸºç¤è²¢ç»çå‹µ (è¬å­—å…ƒ/æ¬¡):</label>
                    <input type="number" id="basicReward" value="500" step="50">
                </div>
                
                <div class="form-group">
                    <label>å‰µæ–°å…±äº«çå‹µ (è¬å­—å…ƒ/æ¬¡):</label>
                    <input type="number" id="innovationReward" value="800" step="50">
                </div>
            </div>
            
            <div class="svg-panel">
                <div class="svg-controls">
                    <button class="zoom-btn" onclick="zoomIn()">æ”¾å¤§ +</button>
                    <button class="zoom-btn" onclick="zoomOut()">ç¸®å° -</button>
                    <button class="zoom-btn" onclick="resetZoom()">é‡ç½®</button>
                    <div class="zoom-info">ç¸®æ”¾: <span id="zoomLevel">100%</span></div>
                    
                    <select id="exportSize" class="export-select">
                        <option value="1920x1080">16:9 (1920x1080)</option>
                        <option value="1280x720">16:9 (1280x720)</option>
                        <option value="1024x768">4:3 (1024x768)</option>
                        <option value="1600x1200">4:3 (1600x1200)</option>
                    </select>
                    <button class="zoom-btn export-btn" onclick="exportToPNG()">ğŸ“¥ ä¸‹è¼‰PNG</button>
                </div>
                <div class="svg-container-wrapper" id="svgWrapper">
                    <svg id="architectureSvg" width="1600" height="1160" viewBox="0 0 1600 1160" xmlns="http://www.w3.org/2000/svg" class="svg-container">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                        </marker>
                    </defs>
                    
                    <!-- Main container -->
                    <rect x="30" y="30" width="1540" height="1100" class="main-container" rx="15"/>
                    
                    <!-- Title -->
                    <text x="800" y="65" text-anchor="middle" class="title-text">ğŸ¯ å­—å…ƒé¡åº¦ç­–ç•¥æ¶æ§‹åœ– (éä¸­å¤®æ©Ÿé—œæœ‰åˆ†é…ç‰ˆ)</text>
                    <text x="800" y="90" text-anchor="middle" class="percentage-text" id="svgTotalBudget">ç¸½é ç®—ï¼š8å„„4,000è¬å­—å…ƒ</text>
                    
                    <!-- Cost deduction section -->
                    <rect x="60" y="110" width="1480" height="100" class="cost-section" rx="10"/>
                    <text x="800" y="135" text-anchor="middle" class="section-title-svg" id="svgCostTitle">ğŸ“‹ æˆæœ¬æ‰£é™¤ (4å„„100è¬å­—å…ƒ)</text>
                    
                    <rect x="80" y="150" width="200" height="50" fill="#FFC107" stroke="#F57C00" stroke-width="2" rx="5"/>
                    <text x="180" y="170" text-anchor="middle" class="normal-text">æ•™è‚²è¨“ç·´</text>
                    <text x="180" y="185" text-anchor="middle" class="normal-text" id="svgTraining">7,500è¬</text>
                    
                    <rect x="300" y="150" width="200" height="50" fill="#FF9800" stroke="#E65100" stroke-width="2" rx="5"/>
                    <text x="400" y="170" text-anchor="middle" class="white-text">æ¸¬è©¦ä½¿ç”¨</text>
                    <text x="400" y="185" text-anchor="middle" class="white-text" id="svgTesting">1å„„2,600è¬</text>
                    
                    <rect x="520" y="150" width="200" height="50" fill="#2196F3" stroke="#1976D2" stroke-width="2" rx="5"/>
                    <text x="620" y="170" text-anchor="middle" class="white-text">æ–°å»ºä¸»æ©Ÿ</text>
                    <text x="620" y="185" text-anchor="middle" class="white-text" id="svgNewServer">2å„„å­—å…ƒ</text>
                    
                    <rect x="740" y="150" width="200" height="50" class="phase-indicator" rx="5"/>
                    <text x="840" y="170" text-anchor="middle" class="normal-text">å‰©é¤˜å¯åˆ†é…</text>
                    <text x="840" y="185" text-anchor="middle" class="highlight-text" id="svgRemaining">4å„„3,900è¬</text>
                    
                    <!-- Phase 1: Basic allocation -->
                    <rect x="60" y="240" width="1480" height="320" class="basic-allocation" rx="12"/>
                    <text x="800" y="270" text-anchor="middle" class="section-title-svg" id="svgPhase1Title">ç¬¬ä¸€éšæ®µï¼šåŸºæœ¬ç›¤é…ç½® - 20% (8,780è¬å­—å…ƒ)</text>
                    
                    <!-- Central government agencies -->
                    <rect x="100" y="300" width="700" height="240" class="central-box" rx="8"/>
                    <text x="450" y="325" text-anchor="middle" class="header-text">ä¸­å¤®äºŒç´šæ©Ÿé—œ (å››ç´šè·åŸºæœ¬ç›¤)</text>
                    <text x="450" y="345" text-anchor="middle" class="small-text">ä¾æˆªè‡³114å¹´7æœˆåº•å„æ©Ÿé—œä½¿ç”¨æƒ…å½¢åˆ†ç­‰ç´šåˆ†é…</text>
                    
                    <!-- Tier 1 -->
                    <rect x="120" y="360" width="150" height="60" class="tier1-box" rx="5"/>
                    <text x="195" y="380" text-anchor="middle" class="white-text">ç¬¬ä¸€ç´š</text>
                    <text x="195" y="395" text-anchor="middle" class="white-text">ä½¿ç”¨ç‡80%+</text>
                    <text x="195" y="410" text-anchor="middle" class="white-text" id="svgTier1">1,000è¬</text>
                    
                    <!-- Tier 2 -->
                    <rect x="290" y="360" width="150" height="60" class="tier2-box" rx="5"/>
                    <text x="365" y="380" text-anchor="middle" class="normal-text">ç¬¬äºŒç´š</text>
                    <text x="365" y="395" text-anchor="middle" class="normal-text">ä½¿ç”¨ç‡20-80%</text>
                    <text x="365" y="410" text-anchor="middle" class="normal-text" id="svgTier2">300è¬</text>
                    
                    <!-- Tier 3 -->
                    <rect x="460" y="360" width="150" height="60" class="tier3-box" rx="5"/>
                    <text x="535" y="380" text-anchor="middle" class="white-text">ç¬¬ä¸‰ç´š</text>
                    <text x="535" y="395" text-anchor="middle" class="white-text">ä½¿ç”¨ç‡10-20%</text>
                    <text x="535" y="410" text-anchor="middle" class="white-text" id="svgTier3">100è¬</text>
                    
                    <!-- Tier 4 -->
                    <rect x="630" y="360" width="150" height="60" class="tier4-box" rx="5"/>
                    <text x="705" y="380" text-anchor="middle" class="white-text">ç¬¬å››ç´š</text>
                    <text x="705" y="395" text-anchor="middle" class="white-text">ä½¿ç”¨ç‡&lt;10%</text>
                    <text x="705" y="410" text-anchor="middle" class="white-text" id="svgTier4">50è¬</text>
                    
                    <!-- Previous period status -->
                    <rect x="120" y="440" width="320" height="60" class="allocation-box" rx="5"/>
                    <text x="280" y="465" text-anchor="middle" class="white-text">ä¸Šä¸€æœŸæœ‰ç”³è«‹ â†’ ä¾ç´šè·åˆ†é…</text>
                    <text x="280" y="485" text-anchor="middle" class="white-text">åŸºæœ¬ç›¤é…ç½®</text>
                    
                    <rect x="460" y="440" width="320" height="60" class="no-allocation-box" rx="5"/>
                    <text x="620" y="465" text-anchor="middle" class="normal-text">ä¸Šä¸€æœŸæœªç”³è«‹ â†’ 0å­—å…ƒ</text>
                    <text x="620" y="485" text-anchor="middle" class="normal-text">(ä¸é…ç½®åŸºæœ¬ç›¤)</text>
                    
                    <!-- Non-central government agencies -->
                    <rect x="840" y="300" width="680" height="240" class="non-central-box" rx="8"/>
                    <text x="1180" y="325" text-anchor="middle" class="header-text">éä¸­å¤®äºŒç´šæ©Ÿé—œ (æœ‰åˆ†é…ç‰ˆæœ¬)</text>
                    
                    <rect x="860" y="350" width="300" height="80" class="allocation-box" rx="5"/>
                    <text x="1010" y="375" text-anchor="middle" class="white-text">ç¬¬ä¸€å¹´æœªç”³è«‹æ©Ÿé—œ</text>
                    <text x="1010" y="395" text-anchor="middle" class="white-text" id="svgNonCentral">çµ±ä¸€é…ç½®ï¼š2,000è¬å­—å…ƒ</text>
                    <text x="1010" y="415" text-anchor="middle" class="white-text">(ä¾‹ï¼š5å€‹æ©Ÿé—œæ¡ˆä¾‹)</text>
                    
                    <rect x="1180" y="350" width="320" height="80" class="allocation-box" rx="5"/>
                    <text x="1340" y="375" text-anchor="middle" class="white-text">ç‰¹æ®Šéœ€æ±‚æ©Ÿé—œ</text>
                    <text x="1340" y="395" text-anchor="middle" class="white-text">ä¾éœ€æ±‚è©•ä¼°é…ç½®</text>
                    <text x="1340" y="415" text-anchor="middle" class="white-text">åŸºæœ¬é¡åº¦ä¿éšœ</text>
                    
                    <rect x="860" y="450" width="640" height="60" class="phase-indicator" rx="5"/>
                    <text x="1180" y="475" text-anchor="middle" class="normal-text">ç•¶ä½¿ç”¨ç‡é”95%æ™‚ï¼Œå¯ç”³è«‹é€²å…¥ç¬¬äºŒéšæ®µ</text>
                    <text x="1180" y="495" text-anchor="middle" class="highlight-text">çå‹µåŠ ç¢¼é‡‘ç”³è«‹</text>
                    
                    <!-- Phase transition -->
                    <rect x="600" y="580" width="400" height="40" class="phase-indicator" rx="8"/>
                    <text x="800" y="605" text-anchor="middle" class="header-text">â¬‡ï¸ ä½¿ç”¨ç‡é”95% â¬‡ï¸</text>
                    
                    <!-- Phase 2: Reward mechanism -->
                    <rect x="60" y="640" width="1480" height="280" class="reward-mechanism" rx="12"/>
                    <text x="800" y="670" text-anchor="middle" class="section-title-svg" id="svgPhase2Title">ç¬¬äºŒéšæ®µï¼šçå‹µåŠ ç¢¼é‡‘ - 80% (3å„„5,120è¬å­—å…ƒ)</text>
                    
                    <!-- Basic contribution reward -->
                    <rect x="100" y="700" width="680" height="180" fill="#E1BEE7" stroke="#9C27B0" stroke-width="2" rx="8"/>
                    <text x="440" y="725" text-anchor="middle" class="header-text">åŸºç¤è²¢ç»çå‹µ</text>
                    
                    <rect x="120" y="750" width="300" height="80" fill="#BA68C8" stroke="#8E24AA" stroke-width="2" rx="5"/>
                    <text x="270" y="775" text-anchor="middle" class="white-text">ç”³è«‹æ¢ä»¶</text>
                    <text x="270" y="795" text-anchor="middle" class="white-text">â€¢ å­—å…ƒä½¿ç”¨ç‡â‰¥95%</text>
                    <text x="270" y="815" text-anchor="middle" class="white-text">â€¢ å®Œæˆç”³è«‹æ–‡ä»¶</text>
                    
                    <rect x="440" y="750" width="320" height="80" fill="#BA68C8" stroke="#8E24AA" stroke-width="2" rx="5"/>
                    <text x="600" y="775" text-anchor="middle" class="white-text">çå‹µé¡åº¦</text>
                    <text x="600" y="795" text-anchor="middle" class="white-text" id="svgBasicReward">æ¯æ¬¡500è¬å­—å…ƒ</text>
                    <text x="600" y="815" text-anchor="middle" class="white-text">ğŸ”’ä¸å—æ­¸é›¶å½±éŸ¿</text>
                    
                    <!-- Innovation sharing reward -->
                    <rect x="820" y="700" width="680" height="180" fill="#E1BEE7" stroke="#9C27B0" stroke-width="2" rx="8"/>
                    <text x="1160" y="725" text-anchor="middle" class="header-text">å‰µæ–°å…±äº«çå‹µ</text>
                    
                    <rect x="840" y="750" width="300" height="80" fill="#BA68C8" stroke="#8E24AA" stroke-width="2" rx="5"/>
                    <text x="990" y="775" text-anchor="middle" class="white-text">ç”³è«‹æ¢ä»¶</text>
                    <text x="990" y="795" text-anchor="middle" class="white-text">â€¢ åŸºç¤è²¢ç»çå‹µåŸºç¤ä¸Š</text>
                    <text x="990" y="815" text-anchor="middle" class="white-text">â€¢ æä¾›å‰µæ–°æ‡‰ç”¨æ¡ˆä¾‹</text>
                    
                    <rect x="1160" y="750" width="320" height="80" fill="#BA68C8" stroke="#8E24AA" stroke-width="2" rx="5"/>
                    <text x="1320" y="775" text-anchor="middle" class="white-text">çå‹µé¡åº¦</text>
                    <text x="1320" y="795" text-anchor="middle" class="white-text" id="svgInnovationReward">æ¯æ¬¡800è¬å­—å…ƒ</text>
                    <text x="1320" y="815" text-anchor="middle" class="white-text">ğŸ”’ä¸å—æ­¸é›¶å½±éŸ¿</text>
                    
                    <!-- Important notes -->
                    <rect x="60" y="940" width="1480" height="160" fill="#FFEBEE" stroke="#F44336" stroke-width="2" rx="8"/>
                    <text x="800" y="965" text-anchor="middle" class="section-title-svg">ğŸ”‘ é‡è¦èªªæ˜</text>
                    <text x="80" y="990" class="normal-text">1. å¹´åº¦æ­¸é›¶æ©Ÿåˆ¶ï¼šç•¶å¹´åº¦æœªä½¿ç”¨å®Œç•¢ä¹‹å­—å…ƒå¾—è½‰å…¥æ¬¡å¹´åº¦è¨ˆç•«é‹ç”¨</text>
                    <text x="80" y="1010" class="normal-text">2. ç¬¬å››ç´šæ©Ÿé—œä¿éšœï¼šä½¿ç”¨ç‡&lt;10%çš„æ©Ÿé—œä»çµ¦äºˆåŸºæœ¬ç›¤50è¬å­—å…ƒ</text>
                    <text x="80" y="1030" class="normal-text">3. æ©Ÿé—œå„€è¡¨æ¿ï¼šçµ±ä¸€ä»¥å­—å…ƒé¡åº¦èˆ‡ç”¨é‡å‘ˆç¾ï¼Œåœ–ç‰‡èªéŸ³å‡è½‰æ›ç‚ºå­—å…ƒè¨ˆç®—</text>
                    <text x="80" y="1050" class="normal-text">4. çå‹µå­—å…ƒä¿éšœï¼šå…·å¯¦è³ªæ•ˆç›ŠBotsçš„çå‹µå­—å…ƒä¸å—å¹´åº¦æ­¸é›¶æ©Ÿåˆ¶å½±éŸ¿</text>
                    <text x="80" y="1070" class="normal-text">5. ç¸¾æ•ˆæ¿€å‹µï¼šç•¶ä½¿ç”¨ç‡é”95%æ™‚å¯ç”³è«‹çå‹µåŠ ç¢¼é‡‘ï¼Œå½¢æˆæ­£å‘å¾ªç’°</text>
                    
                    <!-- Flow arrows -->
                    <line x1="840" y1="210" x2="800" y2="240" class="phase-connector"/>
                    <line x1="800" y1="560" x2="800" y2="580" class="phase-connector"/>
                    <line x1="800" y1="620" x2="800" y2="640" class="phase-connector"/>
                </svg>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç¸®æ”¾åŠŸèƒ½è®Šæ•¸
        let currentZoom = 1;
        const minZoom = 0.3;
        const maxZoom = 3;
        const zoomStep = 0.2;
        
        // ç¸®æ”¾åŠŸèƒ½
        function zoomIn() {
            if (currentZoom < maxZoom) {
                currentZoom += zoomStep;
                updateZoom();
            }
        }
        
        function zoomOut() {
            if (currentZoom > minZoom) {
                currentZoom -= zoomStep;
                updateZoom();
            }
        }
        
        function resetZoom() {
            currentZoom = 1;
            updateZoom();
        }
        
        function updateZoom() {
            const svg = document.getElementById('architectureSvg');
            svg.style.transform = `scale(${currentZoom})`;
            document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
        }
        
        // æ»‘é¼ æ»¾è¼ªç¸®æ”¾
        document.getElementById('svgWrapper').addEventListener('wheel', function(e) {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });
        
        // æ‹–æ‹½åŠŸèƒ½
        let isDragging = false;
        let startX, startY, scrollLeft, scrollTop;
        
        const svgWrapper = document.getElementById('svgWrapper');
        
        svgWrapper.addEventListener('mousedown', function(e) {
            isDragging = true;
            startX = e.pageX - svgWrapper.offsetLeft;
            startY = e.pageY - svgWrapper.offsetTop;
            scrollLeft = svgWrapper.scrollLeft;
            scrollTop = svgWrapper.scrollTop;
        });
        
        svgWrapper.addEventListener('mouseleave', function() {
            isDragging = false;
        });
        
        svgWrapper.addEventListener('mouseup', function() {
            isDragging = false;
        });
        
        svgWrapper.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - svgWrapper.offsetLeft;
            const y = e.pageY - svgWrapper.offsetTop;
            const walkX = (x - startX) * 2;
            const walkY = (y - startY) * 2;
            svgWrapper.scrollLeft = scrollLeft - walkX;
            svgWrapper.scrollTop = scrollTop - walkY;
        });
        
        // PNG å°å‡ºåŠŸèƒ½
        function exportToPNG() {
            // é¡¯ç¤ºè™•ç†ä¸­æç¤º
            const exportBtn = document.querySelector('.export-btn');
            const originalText = exportBtn.textContent;
            exportBtn.textContent = 'è™•ç†ä¸­...';
            exportBtn.disabled = true;
            
            const svg = document.getElementById('architectureSvg');
            const sizeSelect = document.getElementById('exportSize');
            const [width, height] = sizeSelect.value.split('x').map(Number);
            
            // å‰µå»ºcanvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = width;
            canvas.height = height;
            
            // è¨­ç½®é«˜å“è³ªæ¸²æŸ“
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            // è¨­ç½®ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, width, height);
            
            // ç²å–SVGçš„åŸå§‹å°ºå¯¸
            const svgWidth = 1600;
            const svgHeight = 1160;
            
            // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹ä»¥é©æ‡‰ç›®æ¨™å°ºå¯¸
            const scaleX = width / svgWidth;
            const scaleY = height / svgHeight;
            const scale = Math.min(scaleX, scaleY);
            
            // è¨ˆç®—å±…ä¸­ä½ç½®
            const scaledWidth = svgWidth * scale;
            const scaledHeight = svgHeight * scale;
            const offsetX = (width - scaledWidth) / 2;
            const offsetY = (height - scaledHeight) / 2;
            
            // è¤‡è£½SVGä¸¦ç¢ºä¿æ¨£å¼è¢«åŒ…å«
            const svgClone = svg.cloneNode(true);
            
            // æ·»åŠ å®Œæ•´æ¨£å¼åˆ°SVGä¸­
            const styleElement = document.createElementNS('http://www.w3.org/2000/svg', 'style');
            styleElement.textContent = `
                .title-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #1565C0; }
                .section-title-svg { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #333; }
                .header-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #333; }
                .normal-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 14px; fill: #333; }
                .small-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 12px; fill: #333; }
                .white-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 14px; fill: white; font-weight: bold; }
                .highlight-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #D32F2F; }
                .percentage-text { font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #1976D2; }
                
                .main-container { fill: #F8F9FA; stroke: #1976D2; stroke-width: 3; }
                .cost-section { fill: #FFF3E0; stroke: #FF9800; stroke-width: 2; }
                .basic-allocation { fill: #E8F5E8; stroke: #4CAF50; stroke-width: 2; }
                .reward-mechanism { fill: #F3E5F5; stroke: #9C27B0; stroke-width: 2; }
                .central-box { fill: #E3F2FD; stroke: #1976D2; stroke-width: 2; }
                .non-central-box { fill: #E8F5E8; stroke: #4CAF50; stroke-width: 2; }
                
                .tier1-box { fill: #4CAF50; stroke: #2E7D32; stroke-width: 1; }
                .tier2-box { fill: #FFC107; stroke: #F57C00; stroke-width: 1; }
                .tier3-box { fill: #FF9800; stroke: #E65100; stroke-width: 1; }
                .tier4-box { fill: #9E9E9E; stroke: #616161; stroke-width: 1; }
                .allocation-box { fill: #81C784; stroke: #388E3C; stroke-width: 2; }
                .no-allocation-box { fill: #FFCDD2; stroke: #D32F2F; stroke-width: 2; }
                
                .phase-indicator { fill: #FFE082; stroke: #F57C00; stroke-width: 2; }
                .connector { stroke: #666; stroke-width: 2; fill: none; }
                .phase-connector { stroke: #F57C00; stroke-width: 3; fill: none; }
            `;
            svgClone.insertBefore(styleElement, svgClone.firstChild);
            
            const svgData = new XMLSerializer().serializeToString(svgClone);
            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const svgUrl = URL.createObjectURL(svgBlob);
            
            const img = new Image();
            img.onload = function() {
                // ç¹ªè£½SVGåˆ°canvasï¼ˆå±…ä¸­ä¸”ä¿æŒæ¯”ä¾‹ï¼‰
                ctx.drawImage(img, offsetX, offsetY, scaledWidth, scaledHeight);
                
                // è½‰æ›ç‚ºPNGä¸¦ä¸‹è¼‰
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    // ç”Ÿæˆæ–‡ä»¶å
                    const now = new Date();
                    const timestamp = now.toISOString().slice(0, 10).replace(/-/g, '');
                    const timeStamp = now.toTimeString().slice(0, 5).replace(/:/g, '');
                    const sizeLabel = sizeSelect.value;
                    const totalBudget = document.getElementById('totalBudget').value;
                    
                    a.download = `å­—å…ƒç­–ç•¥æ¶æ§‹åœ–_${totalBudget}å„„_${sizeLabel}_${timestamp}_${timeStamp}.png`;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    URL.revokeObjectURL(url);
                    URL.revokeObjectURL(svgUrl);
                    
                    // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                    exportBtn.textContent = originalText;
                    exportBtn.disabled = false;
                }, 'image/png', 1.0);
            };
            
            img.onerror = function() {
                alert('å°å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦');
                URL.revokeObjectURL(svgUrl);
                
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                exportBtn.textContent = originalText;
                exportBtn.disabled = false;
            };
            
            img.src = svgUrl;
        }

        // æ ¼å¼åŒ–æ•¸å­—ç‚ºä¸­æ–‡é‡‘é¡é¡¯ç¤º
        function formatChineseAmount(value) {
            if (value >= 10000) {
                const yi = Math.floor(value / 10000);
                const wan = value % 10000;
                if (wan === 0) {
                    return `${yi}å„„å­—å…ƒ`;
                } else {
                    return `${yi}å„„${wan.toLocaleString()}è¬å­—å…ƒ`;
                }
            } else {
                return `${value.toLocaleString()}è¬å­—å…ƒ`;
            }
        }

        // è¨ˆç®—å‡½æ•¸
        function calculate() {
            // ç²å–è¼¸å…¥å€¼
            const totalBudget = parseFloat(document.getElementById('totalBudget').value);
            const training = parseFloat(document.getElementById('training').value);
            const testing = parseFloat(document.getElementById('testing').value);
            const newServer = parseFloat(document.getElementById('newServer').value);
            const basicPercentage = parseFloat(document.getElementById('basicPercentage').value);
            const rewardPercentage = parseFloat(document.getElementById('rewardPercentage').value);
            
            const tier1Amount = parseFloat(document.getElementById('tier1Amount').value);
            const tier2Amount = parseFloat(document.getElementById('tier2Amount').value);
            const tier3Amount = parseFloat(document.getElementById('tier3Amount').value);
            const tier4Amount = parseFloat(document.getElementById('tier4Amount').value);
            const nonCentralAmount = parseFloat(document.getElementById('nonCentralAmount').value);
            const basicReward = parseFloat(document.getElementById('basicReward').value);
            const innovationReward = parseFloat(document.getElementById('innovationReward').value);

            // è¨ˆç®—ç¸½é ç®—ï¼ˆè¬å­—å…ƒï¼‰
            const totalBudgetWan = totalBudget * 10000;
            
            // è¨ˆç®—ç¸½æˆæœ¬æ‰£é™¤
            const newServerWan = newServer * 10000;
            const totalCostWan = training + testing + newServerWan;
            
            // è¨ˆç®—å‰©é¤˜å¯åˆ†é…
            const remainingWan = totalBudgetWan - totalCostWan;
            
            // è¨ˆç®—åŸºæœ¬ç›¤ç¸½é¡
            const basicTotalWan = remainingWan * (basicPercentage / 100);
            
            // è¨ˆç®—çå‹µæ©Ÿåˆ¶ç¸½é¡
            const rewardTotalWan = remainingWan * (rewardPercentage / 100);

            // æ›´æ–°è¡¨å–®é¡¯ç¤º
            document.getElementById('totalBudgetDisplay').textContent = formatChineseAmount(totalBudgetWan);
            document.getElementById('totalCost').textContent = formatChineseAmount(totalCostWan);
            document.getElementById('remainingBudget').textContent = formatChineseAmount(remainingWan);
            document.getElementById('basicTotal').textContent = formatChineseAmount(basicTotalWan);
            document.getElementById('rewardTotal').textContent = formatChineseAmount(rewardTotalWan);

            // æ›´æ–°SVGé¡¯ç¤º
            document.getElementById('svgTotalBudget').textContent = `ç¸½é ç®—ï¼š${formatChineseAmount(totalBudgetWan)}`;
            document.getElementById('svgCostTitle').textContent = `ğŸ“‹ æˆæœ¬æ‰£é™¤ (${formatChineseAmount(totalCostWan)})`;
            document.getElementById('svgTraining').textContent = `${training.toLocaleString()}è¬`;
            
            // è™•ç†æ¸¬è©¦ä½¿ç”¨çš„é¡¯ç¤º
            if (testing >= 10000) {
                const yi = Math.floor(testing / 10000);
                const wan = testing % 10000;
                if (wan === 0) {
                    document.getElementById('svgTesting').textContent = `${yi}å„„`;
                } else {
                    document.getElementById('svgTesting').textContent = `${yi}å„„${wan.toLocaleString()}è¬`;
                }
            } else {
                document.getElementById('svgTesting').textContent = `${testing.toLocaleString()}è¬`;
            }
            
            // è™•ç†æ–°å»ºä¸»æ©Ÿçš„é¡¯ç¤º
            if (newServer % 1 === 0) {
                document.getElementById('svgNewServer').textContent = `${newServer}å„„å­—å…ƒ`;
            } else {
                document.getElementById('svgNewServer').textContent = `${newServer}å„„å­—å…ƒ`;
            }
            
            document.getElementById('svgRemaining').textContent = formatChineseAmount(remainingWan);
            
            document.getElementById('svgPhase1Title').textContent = 
                `ç¬¬ä¸€éšæ®µï¼šåŸºæœ¬ç›¤é…ç½® - ${basicPercentage}% (${formatChineseAmount(basicTotalWan)})`;
            
            document.getElementById('svgTier1').textContent = `${tier1Amount.toLocaleString()}è¬`;
            document.getElementById('svgTier2').textContent = `${tier2Amount.toLocaleString()}è¬`;
            document.getElementById('svgTier3').textContent = `${tier3Amount.toLocaleString()}è¬`;
            document.getElementById('svgTier4').textContent = `${tier4Amount.toLocaleString()}è¬`;
            document.getElementById('svgNonCentral').textContent = `çµ±ä¸€é…ç½®ï¼š${nonCentralAmount.toLocaleString()}è¬å­—å…ƒ`;
            
            document.getElementById('svgPhase2Title').textContent = 
                `ç¬¬äºŒéšæ®µï¼šçå‹µåŠ ç¢¼é‡‘ - ${rewardPercentage}% (${formatChineseAmount(rewardTotalWan)})`;
            
            document.getElementById('svgBasicReward').textContent = `æ¯æ¬¡${basicReward.toLocaleString()}è¬å­—å…ƒ`;
            document.getElementById('svgInnovationReward').textContent = `æ¯æ¬¡${innovationReward.toLocaleString()}è¬å­—å…ƒ`;
        }

        // ç‚ºæ‰€æœ‰è¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½å™¨
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', calculate);
            });
            
            // åˆå§‹è¨ˆç®—
            calculate();
        });
    </script>
</body>
</html>